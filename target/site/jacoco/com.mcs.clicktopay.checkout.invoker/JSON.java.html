<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSON.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">clicktopay-reference-app</a> &gt; <a href="index.source.html" class="el_package">com.mcs.clicktopay.checkout.invoker</a> &gt; <span class="el_source">JSON.java</span></div><h1>JSON.java</h1><pre class="source lang-java linenums">/*
 * Click to Pay Checkout API
 * Checkout end point used by Click to Pay Integrators to receive payload data from the Mastercard Checkout Solutions and send the results of transaction authorization back to the Mastercard. Endpoints are available to retrieve payload data and send the outcome of a payment or checkout.
 *
 * The version of the OpenAPI document: 1.0.0
 * Contact: apisupport@mastercard.com
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */


package com.mcs.clicktopay.checkout.invoker;

import com.fasterxml.jackson.databind.util.StdDateFormat;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonParseException;
import com.google.gson.TypeAdapter;
import com.google.gson.stream.JsonReader;
import com.google.gson.stream.JsonWriter;
import com.google.gson.JsonElement;
import io.gsonfire.GsonFireBuilder;
import io.gsonfire.TypeSelector;

import okio.ByteString;

import java.io.IOException;
import java.io.StringReader;
import java.lang.reflect.Type;
import java.text.DateFormat;
import java.text.ParseException;
import java.time.LocalDate;
import java.time.OffsetDateTime;
import java.time.ZoneId;
import java.time.ZoneOffset;
import java.time.format.DateTimeFormatter;
import java.util.Date;
import java.util.Locale;
import java.util.Map;
import java.util.HashMap;
import java.util.TimeZone;

/*
 * A JSON utility class
 *
 * NOTE: in the future, this class may be converted to static, which may break
 *       backward-compatibility
 */
<span class="fc" id="L51">public class JSON {</span>
    private static Gson gson;
<span class="fc" id="L53">    private static boolean isLenientOnJson = false;</span>
<span class="fc" id="L54">    private static DateTypeAdapter dateTypeAdapter = new DateTypeAdapter();</span>
<span class="fc" id="L55">    private static SqlDateTypeAdapter sqlDateTypeAdapter = new SqlDateTypeAdapter();</span>
<span class="fc" id="L56">    private static OffsetDateTimeTypeAdapter offsetDateTimeTypeAdapter = new OffsetDateTimeTypeAdapter();</span>
<span class="fc" id="L57">    private static LocalDateTypeAdapter localDateTypeAdapter = new LocalDateTypeAdapter();</span>
<span class="fc" id="L58">    private static ByteArrayAdapter byteArrayAdapter = new ByteArrayAdapter();</span>

<span class="fc" id="L60">    private static final StdDateFormat sdf = new StdDateFormat()</span>
<span class="fc" id="L61">        .withTimeZone(TimeZone.getTimeZone(ZoneId.systemDefault()))</span>
<span class="fc" id="L62">        .withColonInTimeZone(true);</span>
<span class="fc" id="L63">    private static final DateTimeFormatter dtf = DateTimeFormatter.ISO_OFFSET_DATE_TIME;</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    public static GsonBuilder createGson() {
<span class="fc" id="L67">        GsonFireBuilder fireBuilder = new GsonFireBuilder()</span>
        ;
<span class="fc" id="L69">        GsonBuilder builder = fireBuilder.createGsonBuilder();</span>
<span class="fc" id="L70">        return builder;</span>
    }

    private static String getDiscriminatorValue(JsonElement readElement, String discriminatorField) {
<span class="nc" id="L74">        JsonElement element = readElement.getAsJsonObject().get(discriminatorField);</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">        if (null == element) {</span>
<span class="nc" id="L76">            throw new IllegalArgumentException(&quot;missing discriminator field: &lt;&quot; + discriminatorField + &quot;&gt;&quot;);</span>
        }
<span class="nc" id="L78">        return element.getAsString();</span>
    }

    /**
     * Returns the Java class that implements the OpenAPI schema for the specified discriminator value.
     *
     * @param classByDiscriminatorValue The map of discriminator values to Java classes.
     * @param discriminatorValue The value of the OpenAPI discriminator in the input data.
     * @return The Java class that implements the OpenAPI schema
     */
    private static Class getClassByDiscriminator(Map classByDiscriminatorValue, String discriminatorValue) {
<span class="nc" id="L89">        Class clazz = (Class) classByDiscriminatorValue.get(discriminatorValue);</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (null == clazz) {</span>
<span class="nc" id="L91">            throw new IllegalArgumentException(&quot;cannot determine model class of name: &lt;&quot; + discriminatorValue + &quot;&gt;&quot;);</span>
        }
<span class="nc" id="L93">        return clazz;</span>
    }

    {
<span class="fc" id="L97">        GsonBuilder gsonBuilder = createGson();</span>
<span class="fc" id="L98">        gsonBuilder.registerTypeAdapter(Date.class, dateTypeAdapter);</span>
<span class="fc" id="L99">        gsonBuilder.registerTypeAdapter(java.sql.Date.class, sqlDateTypeAdapter);</span>
<span class="fc" id="L100">        gsonBuilder.registerTypeAdapter(OffsetDateTime.class, offsetDateTimeTypeAdapter);</span>
<span class="fc" id="L101">        gsonBuilder.registerTypeAdapter(LocalDate.class, localDateTypeAdapter);</span>
<span class="fc" id="L102">        gsonBuilder.registerTypeAdapter(byte[].class, byteArrayAdapter);</span>
<span class="fc" id="L103">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.Address.CustomTypeAdapterFactory());</span>
<span class="fc" id="L104">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.AssuranceData.CustomTypeAdapterFactory());</span>
<span class="fc" id="L105">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.Card.CustomTypeAdapterFactory());</span>
<span class="fc" id="L106">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.CheckoutRequest.CustomTypeAdapterFactory());</span>
<span class="fc" id="L107">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.CheckoutResponse.CustomTypeAdapterFactory());</span>
<span class="fc" id="L108">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.CheckoutResponseJWS.CustomTypeAdapterFactory());</span>
<span class="fc" id="L109">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.CheckoutResponseJWSPayload.CustomTypeAdapterFactory());</span>
<span class="fc" id="L110">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.CommunicationsConsent.CustomTypeAdapterFactory());</span>
<span class="fc" id="L111">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.ComplianceSettings.CustomTypeAdapterFactory());</span>
<span class="fc" id="L112">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.Consent.CustomTypeAdapterFactory());</span>
<span class="fc" id="L113">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.DCF.CustomTypeAdapterFactory());</span>
<span class="fc" id="L114">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.DigitalCardData.CustomTypeAdapterFactory());</span>
<span class="fc" id="L115">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.DigitalCardFeature.CustomTypeAdapterFactory());</span>
<span class="fc" id="L116">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.DigitalTransactionData.CustomTypeAdapterFactory());</span>
<span class="fc" id="L117">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.DynamicData.CustomTypeAdapterFactory());</span>
<span class="fc" id="L118">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.Error.CustomTypeAdapterFactory());</span>
<span class="fc" id="L119">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.ErrorDetail.CustomTypeAdapterFactory());</span>
<span class="fc" id="L120">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.JoseHeader.CustomTypeAdapterFactory());</span>
<span class="fc" id="L121">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.MaskedAddress.CustomTypeAdapterFactory());</span>
<span class="fc" id="L122">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.MaskedCard.CustomTypeAdapterFactory());</span>
<span class="fc" id="L123">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.MaskedConsumer.CustomTypeAdapterFactory());</span>
<span class="fc" id="L124">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.MaskedConsumerIdentity.CustomTypeAdapterFactory());</span>
<span class="fc" id="L125">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.Payload.CustomTypeAdapterFactory());</span>
<span class="fc" id="L126">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.PaymentToken.CustomTypeAdapterFactory());</span>
<span class="fc" id="L127">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.PhoneNumber.CustomTypeAdapterFactory());</span>
<span class="fc" id="L128">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.RequestAddress.CustomTypeAdapterFactory());</span>
<span class="fc" id="L129">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.SrcTokenResultsData.CustomTypeAdapterFactory());</span>
<span class="fc" id="L130">        gsonBuilder.registerTypeAdapterFactory(new com.mcs.clicktopay.checkout.model.VerificationData.CustomTypeAdapterFactory());</span>
<span class="fc" id="L131">        gson = gsonBuilder.create();</span>
<span class="fc" id="L132">    }</span>

    /**
     * Get Gson.
     *
     * @return Gson
     */
    public static Gson getGson() {
<span class="nc" id="L140">        return gson;</span>
    }

    /**
     * Set Gson.
     *
     * @param gson Gson
     */
    public static void setGson(Gson gson) {
<span class="nc" id="L149">        JSON.gson = gson;</span>
<span class="nc" id="L150">    }</span>

    public static void setLenientOnJson(boolean lenientOnJson) {
<span class="nc" id="L153">        isLenientOnJson = lenientOnJson;</span>
<span class="nc" id="L154">    }</span>

    /**
     * Serialize the given Java object into JSON string.
     *
     * @param obj Object
     * @return String representation of the JSON
     */
    public static String serialize(Object obj) {
<span class="nc" id="L163">        return gson.toJson(obj);</span>
    }

    /**
     * Deserialize the given JSON string to Java object.
     *
     * @param &lt;T&gt;        Type
     * @param body       The JSON string
     * @param returnType The type to deserialize into
     * @return The deserialized Java object
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; T deserialize(String body, Type returnType) {
        try {
<span class="nc bnc" id="L177" title="All 2 branches missed.">            if (isLenientOnJson) {</span>
<span class="nc" id="L178">                JsonReader jsonReader = new JsonReader(new StringReader(body));</span>
                // see https://google-gson.googlecode.com/svn/trunk/gson/docs/javadocs/com/google/gson/stream/JsonReader.html#setLenient(boolean)
<span class="nc" id="L180">                jsonReader.setLenient(true);</span>
<span class="nc" id="L181">                return gson.fromJson(jsonReader, returnType);</span>
            } else {
<span class="nc" id="L183">                return gson.fromJson(body, returnType);</span>
            }
<span class="nc" id="L185">        } catch (JsonParseException e) {</span>
            // Fallback processing when failed to parse JSON form response body:
            // return the response body string directly for the String return type;
<span class="nc bnc" id="L188" title="All 2 branches missed.">            if (returnType.equals(String.class)) {</span>
<span class="nc" id="L189">                return (T) body;</span>
            } else {
<span class="nc" id="L191">                throw (e);</span>
            }
        }
    }

    /**
     * Gson TypeAdapter for Byte Array type
     */
<span class="fc" id="L199">    public static class ByteArrayAdapter extends TypeAdapter&lt;byte[]&gt; {</span>

        @Override
        public void write(JsonWriter out, byte[] value) throws IOException {
<span class="nc bnc" id="L203" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L204">                out.nullValue();</span>
            } else {
<span class="nc" id="L206">                out.value(ByteString.of(value).base64());</span>
            }
<span class="nc" id="L208">        }</span>

        @Override
        public byte[] read(JsonReader in) throws IOException {
<span class="nc bnc" id="L212" title="All 2 branches missed.">            switch (in.peek()) {</span>
                case NULL:
<span class="nc" id="L214">                    in.nextNull();</span>
<span class="nc" id="L215">                    return null;</span>
                default:
<span class="nc" id="L217">                    String bytesAsBase64 = in.nextString();</span>
<span class="nc" id="L218">                    ByteString byteString = ByteString.decodeBase64(bytesAsBase64);</span>
<span class="nc" id="L219">                    return byteString.toByteArray();</span>
            }
        }
    }

    /**
     * Gson TypeAdapter for JSR310 OffsetDateTime type
     */
    public static class OffsetDateTimeTypeAdapter extends TypeAdapter&lt;OffsetDateTime&gt; {

        private DateTimeFormatter formatter;

        public OffsetDateTimeTypeAdapter() {
<span class="fc" id="L232">            this(DateTimeFormatter.ISO_OFFSET_DATE_TIME);</span>
<span class="fc" id="L233">        }</span>

<span class="fc" id="L235">        public OffsetDateTimeTypeAdapter(DateTimeFormatter formatter) {</span>
<span class="fc" id="L236">            this.formatter = formatter;</span>
<span class="fc" id="L237">        }</span>

        public void setFormat(DateTimeFormatter dateFormat) {
<span class="nc" id="L240">            this.formatter = dateFormat;</span>
<span class="nc" id="L241">        }</span>

        @Override
        public void write(JsonWriter out, OffsetDateTime date) throws IOException {
<span class="nc bnc" id="L245" title="All 2 branches missed.">            if (date == null) {</span>
<span class="nc" id="L246">                out.nullValue();</span>
            } else {
<span class="nc" id="L248">                out.value(formatter.format(date));</span>
            }
<span class="nc" id="L250">        }</span>

        @Override
        public OffsetDateTime read(JsonReader in) throws IOException {
<span class="nc bnc" id="L254" title="All 2 branches missed.">            switch (in.peek()) {</span>
                case NULL:
<span class="nc" id="L256">                    in.nextNull();</span>
<span class="nc" id="L257">                    return null;</span>
                default:
<span class="nc" id="L259">                    String date = in.nextString();</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">                    if (date.endsWith(&quot;+0000&quot;)) {</span>
<span class="nc" id="L261">                        date = date.substring(0, date.length()-5) + &quot;Z&quot;;</span>
                    }
<span class="nc" id="L263">                    return OffsetDateTime.parse(date, formatter);</span>
            }
        }
    }

    /**
     * Gson TypeAdapter for JSR310 LocalDate type
     */
    public static class LocalDateTypeAdapter extends TypeAdapter&lt;LocalDate&gt; {

        private DateTimeFormatter formatter;

        public LocalDateTypeAdapter() {
<span class="fc" id="L276">            this(DateTimeFormatter.ISO_LOCAL_DATE);</span>
<span class="fc" id="L277">        }</span>

<span class="fc" id="L279">        public LocalDateTypeAdapter(DateTimeFormatter formatter) {</span>
<span class="fc" id="L280">            this.formatter = formatter;</span>
<span class="fc" id="L281">        }</span>

        public void setFormat(DateTimeFormatter dateFormat) {
<span class="nc" id="L284">            this.formatter = dateFormat;</span>
<span class="nc" id="L285">        }</span>

        @Override
        public void write(JsonWriter out, LocalDate date) throws IOException {
<span class="nc bnc" id="L289" title="All 2 branches missed.">            if (date == null) {</span>
<span class="nc" id="L290">                out.nullValue();</span>
            } else {
<span class="nc" id="L292">                out.value(formatter.format(date));</span>
            }
<span class="nc" id="L294">        }</span>

        @Override
        public LocalDate read(JsonReader in) throws IOException {
<span class="nc bnc" id="L298" title="All 2 branches missed.">            switch (in.peek()) {</span>
                case NULL:
<span class="nc" id="L300">                    in.nextNull();</span>
<span class="nc" id="L301">                    return null;</span>
                default:
<span class="nc" id="L303">                    String date = in.nextString();</span>
<span class="nc" id="L304">                    return LocalDate.parse(date, formatter);</span>
            }
        }
    }

    public static void setOffsetDateTimeFormat(DateTimeFormatter dateFormat) {
<span class="nc" id="L310">        offsetDateTimeTypeAdapter.setFormat(dateFormat);</span>
<span class="nc" id="L311">    }</span>

    public static void setLocalDateFormat(DateTimeFormatter dateFormat) {
<span class="nc" id="L314">        localDateTypeAdapter.setFormat(dateFormat);</span>
<span class="nc" id="L315">    }</span>

    /**
     * Gson TypeAdapter for java.sql.Date type
     * If the dateFormat is null, a simple &quot;yyyy-MM-dd&quot; format will be used
     * (more efficient than SimpleDateFormat).
     */
    public static class SqlDateTypeAdapter extends TypeAdapter&lt;java.sql.Date&gt; {

        private DateFormat dateFormat;

<span class="fc" id="L326">        public SqlDateTypeAdapter() {}</span>

<span class="nc" id="L328">        public SqlDateTypeAdapter(DateFormat dateFormat) {</span>
<span class="nc" id="L329">            this.dateFormat = dateFormat;</span>
<span class="nc" id="L330">        }</span>

        public void setFormat(DateFormat dateFormat) {
<span class="nc" id="L333">            this.dateFormat = dateFormat;</span>
<span class="nc" id="L334">        }</span>

        @Override
        public void write(JsonWriter out, java.sql.Date date) throws IOException {
<span class="nc bnc" id="L338" title="All 2 branches missed.">            if (date == null) {</span>
<span class="nc" id="L339">                out.nullValue();</span>
            } else {
                String value;
<span class="nc bnc" id="L342" title="All 2 branches missed.">                if (dateFormat != null) {</span>
<span class="nc" id="L343">                    value = dateFormat.format(date);</span>
                } else {
<span class="nc" id="L345">                    value = date.toString();</span>
                }
<span class="nc" id="L347">                out.value(value);</span>
            }
<span class="nc" id="L349">        }</span>

        @Override
        public java.sql.Date read(JsonReader in) throws IOException {
<span class="nc bnc" id="L353" title="All 2 branches missed.">            switch (in.peek()) {</span>
                case NULL:
<span class="nc" id="L355">                    in.nextNull();</span>
<span class="nc" id="L356">                    return null;</span>
                default:
<span class="nc" id="L358">                    String date = in.nextString();</span>
                    try {
<span class="nc bnc" id="L360" title="All 2 branches missed.">                        if (dateFormat != null) {</span>
<span class="nc" id="L361">                            return new java.sql.Date(dateFormat.parse(date).getTime());</span>
                        }
<span class="nc" id="L363">                        return new java.sql.Date(sdf.parse(date).getTime());</span>
<span class="nc" id="L364">                    } catch (ParseException e) {</span>
<span class="nc" id="L365">                        throw new JsonParseException(e);</span>
                    }
            }
        }
    }

    /**
     * Gson TypeAdapter for java.util.Date type
     * If the dateFormat is null, DateTimeFormatter will be used.
     */
    public static class DateTypeAdapter extends TypeAdapter&lt;Date&gt; {

        private DateFormat dateFormat;

<span class="fc" id="L379">        public DateTypeAdapter() {}</span>

<span class="nc" id="L381">        public DateTypeAdapter(DateFormat dateFormat) {</span>
<span class="nc" id="L382">            this.dateFormat = dateFormat;</span>
<span class="nc" id="L383">        }</span>

        public void setFormat(DateFormat dateFormat) {
<span class="nc" id="L386">            this.dateFormat = dateFormat;</span>
<span class="nc" id="L387">        }</span>

        @Override
        public void write(JsonWriter out, Date date) throws IOException {
<span class="nc bnc" id="L391" title="All 2 branches missed.">            if (date == null) {</span>
<span class="nc" id="L392">                out.nullValue();</span>
            } else {
                String value;
<span class="nc bnc" id="L395" title="All 2 branches missed.">                if (dateFormat != null) {</span>
<span class="nc" id="L396">                    value = dateFormat.format(date);</span>
                } else {
<span class="nc" id="L398">                    value = date.toInstant().atOffset(ZoneOffset.UTC).format(dtf);</span>
                }
<span class="nc" id="L400">                out.value(value);</span>
            }
<span class="nc" id="L402">        }</span>

        @Override
        public Date read(JsonReader in) throws IOException {
            try {
<span class="nc bnc" id="L407" title="All 2 branches missed.">                switch (in.peek()) {</span>
                    case NULL:
<span class="nc" id="L409">                        in.nextNull();</span>
<span class="nc" id="L410">                        return null;</span>
                    default:
<span class="nc" id="L412">                        String date = in.nextString();</span>
                        try {
<span class="nc bnc" id="L414" title="All 2 branches missed.">                            if (dateFormat != null) {</span>
<span class="nc" id="L415">                                return dateFormat.parse(date);</span>
                            }
<span class="nc" id="L417">                            return sdf.parse(date);</span>
<span class="nc" id="L418">                        } catch (ParseException e) {</span>
<span class="nc" id="L419">                            throw new JsonParseException(e);</span>
                        }
                }
<span class="nc" id="L422">            } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L423">                throw new JsonParseException(e);</span>
            }
        }
    }

    public static void setDateFormat(DateFormat dateFormat) {
<span class="nc" id="L429">        dateTypeAdapter.setFormat(dateFormat);</span>
<span class="nc" id="L430">    }</span>

    public static void setSqlDateFormat(DateFormat dateFormat) {
<span class="nc" id="L433">        sqlDateTypeAdapter.setFormat(dateFormat);</span>
<span class="nc" id="L434">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>